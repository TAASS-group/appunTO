services:
  appunto-userservice-app:
    build:
      context: backend/userservice
      args:
        firebase_service_account_file: firebase_service_account_file.json
    image: appunto-userservice-app
    container_name: userservice-app
    depends_on:
      - appunto-userservice-db
      - appunto-eurekaserver-app
    ports:
      - 8081:8080
    networks:
      userservice-internal:
      internal:
        aliases:
          - userservice

  appunto-userservice-db:
    image: postgres
    container_name: userservice-db
    restart: unless-stopped
    volumes:
      - userservice-db-data:/var/lib/postgresql/data
    ports:
      - 5433:5432
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: password
    networks:
      userservice-internal:
        aliases:
          - userservicedb

  appunto-fileservice-app:
    build:
      context: backend/fileService
    image: appunto-fileservice-app
    container_name: fileservice-app
    depends_on:
      - appunto-fileservice-db
      - appunto-eurekaserver-app
    ports:
      - 8082:8080
    networks:
      fileservice-internal:
      internal:
        aliases:
          - fileservice

  appunto-fileservice-db:
    image: mongo
    container_name: fileservice-db
    ports:
      - 27017:27017
    volumes:
      - fileservice-db-data:/data/db
      - fileservice-db-config:/data/configdb
    # environment: TODO: mettere a posto credenziali!
      # MONGO_INITDB_ROOT_USERNAME: admin
      # MONGO_INITDB_ROOT_PASSWORD: password
      # MONGO_INITDB_DATABASE: fileservice
    networks:
      fileservice-internal:
        aliases:
          - fileservicedb

  appunto-courseservice-app:
    build:
      context: backend/courseservice
    image: appunto-courseservice-app
    container_name: courseservice-app
    depends_on:
      - appunto-courseservice-db
      - appunto-eurekaserver-app
    ports:
      - 8083:8080
    networks:
      courseservice-internal:
      internal:
        aliases:
          - courseservice

  appunto-courseservice-db:
    image: postgres
    container_name: courseservice-db
    restart: unless-stopped
    volumes:
      - courseservice-db-data:/var/lib/postgresql/data
    ports:
      - 5434:5432
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: password
    networks:
      courseservice-internal:
        aliases:
          - courseservicedb

  appunto-forumservice-app:
    build:
      context: backend/forumService
    image: appunto-forumservice-app
    container_name: forumservice-app
    depends_on:
      - appunto-forumservice-db
      - appunto-eurekaserver-app
    ports:
      - 8084:8080
    networks:
      forumservice-internal:
      internal:
        aliases:
          - forumservice

  appunto-forumservice-db:
    image: postgres
    container_name: forumservice-db
    restart: unless-stopped
    volumes:
      - forumservice-db-data:/var/lib/postgresql/data
    ports:
      - 5435:5432
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: password
    networks:
      forumservice-internal:
        aliases:
          - forumservicedb

  appunto-apigateway-app:
    build:
      context: backend/apigateway
    image: appunto-apigateway-app
    container_name: apigateway-app
    depends_on:
      - appunto-eurekaserver-app
    ports:
      - 8080:8080
    networks:
      - internal

  appunto-eurekaserver-app:
    build:
      context: backend/eurekaServer
    image: appunto-eurekaserver-app
    container_name: eurekaserver-app
    ports:
      - 8761:8761
    networks:
      internal:
        aliases:
          - eurekaserver

#  rabbitmq:
#    build:
#      context: rabbitMQ
#    container_name: rabbitMQ
#    restart: unless-stopped
#    ports:
#      - 5672:5672
#      - 15672:15672 # management
#    networks:
#      - internal


volumes:
  userservice-db-data: {}
  fileservice-db-data: {}
  fileservice-db-config: {}
  courseservice-db-data: {}
  forumservice-db-data: {}

networks:
  internal: {}
  userservice-internal: {}
  fileservice-internal: {}
  courseservice-internal: {}
  forumservice-internal: {}
